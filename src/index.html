<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Primary Meta Tags -->
    <title>–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤—Ä–µ–º–µ–Ω–∞ ‚Äî —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∏ —Ç–∞–±–ª–∏—Ü–∞ —Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏ | Tense Trainer</title>
    <meta name="title" content="–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤—Ä–µ–º–µ–Ω–∞ ‚Äî —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∏ —Ç–∞–±–ª–∏—Ü–∞ —Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏">
    <meta name="description" content="–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º—ë–Ω —Å —Ç–∞–±–ª–∏—Ü–µ–π, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏ –∏ —Ç–µ—Å—Ç–∞–º–∏. –ò–∑—É—á–∞–π Present Simple, Past Simple, Future Simple, Present Perfect –æ–Ω–ª–∞–π–Ω. –î–ª—è –¥–µ—Ç–µ–π, —à–∫–æ–ª—å–Ω–∏–∫–æ–≤ –∏ –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö. –ü—Ä–∞–∫—Ç–∏–∫–∞ –≤—Å–µ—Ö 12 –≤—Ä–µ–º—ë–Ω –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞!">
    <meta name="keywords" content="–∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤—Ä–µ–º–µ–Ω–∞, —Ç–∞–±–ª–∏—Ü–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º–µ–Ω, —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º–µ–Ω, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ –≤—Ä–µ–º–µ–Ω–∞, present simple, past simple, future simple, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π –¥–ª—è –¥–µ—Ç–µ–π, –∏–∑—É—á–µ–Ω–∏–µ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ">
    <meta name="author" content="Tense Trainer">
    <meta name="robots" content="index, follow">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tensetrainer.ru/">
    <meta property="og:title" content="–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤—Ä–µ–º–µ–Ω–∞ ‚Äî —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∏ —Ç–∞–±–ª–∏—Ü–∞ —Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏">
    <meta property="og:description" content="–¢—Ä–µ–Ω–∞–∂—ë—Ä –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º—ë–Ω —Å —Ç–∞–±–ª–∏—Ü–µ–π –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è–º–∏. Present Simple, Past Simple, Future Simple, Present Perfect. –ë–µ—Å–ø–ª–∞—Ç–Ω–æ!">
    <meta property="og:image" content="https://tensetrainer.ru/og-image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://tensetrainer.ru/">
    <meta property="twitter:title" content="Tense Trainer ‚Äî –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º—ë–Ω">
    <meta property="twitter:description" content="–ë–µ—Å–ø–ª–∞—Ç–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º—ë–Ω. –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è –¥–µ—Ç–µ–π 10-12 –ª–µ—Ç.">
    <meta property="twitter:image" content="https://tensetrainer.ru/og-image.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://tensetrainer.ru/">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéØ</text></svg>">

    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Tense Trainer",
        "description": "–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º—ë–Ω –¥–ª—è –¥–µ—Ç–µ–π 10-12 –ª–µ—Ç",
        "url": "https://tensetrainer.ru/",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "RUB"
        },
        "audience": {
            "@type": "EducationalAudience",
            "educationalRole": "student"
        }
    }
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID" crossorigin="anonymous"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card: #ffffff;
            --text: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --radius: 12px;
            --radius-sm: 8px;
        }
        [data-theme="dark"] {
            --bg: #0f172a;
            --card: #1e293b;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }
        .app-container { max-width: 900px; margin: 0 auto; padding: 16px; }
        .hidden { display: none !important; }
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }
        .header h1 { font-size: 1.8rem; margin-bottom: 8px; }
        .header p { opacity: 0.9; font-size: 0.95rem; }
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        .theme-toggle {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 1.2rem;
        }
        .nav {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            background: var(--card);
            padding: 12px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
        }
        .nav-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px 16px;
            border: 2px solid var(--border);
            background: var(--card);
            color: var(--text);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
        }
        .nav-btn:hover { border-color: var(--primary); color: var(--primary); }
        .nav-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        .card-title {
            font-size: 1.3rem;
            margin-bottom: 16px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-1px); }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-secondary:hover { background: #059669; }
        .btn-accent { background: var(--accent); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--border); color: var(--text); }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 8px 16px; font-size: 0.875rem; }
        .quick-start {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid var(--accent);
        }
        .quick-start h3 { color: #92400e; margin-bottom: 12px; }
        .preset-btns { display: flex; flex-wrap: wrap; gap: 8px; margin: 12px 0; }
        .preset-btn {
            padding: 10px 16px;
            background: white;
            border: 2px solid var(--accent);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
        }
        .preset-btn:hover { background: var(--accent); color: white; }
        .checkbox-list { display: grid; gap: 10px; }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--bg);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        .checkbox-item:hover { border-color: var(--primary-light); }
        .checkbox-item input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: var(--primary);
            cursor: pointer;
        }
        .checkbox-item.checked { border-color: var(--primary); background: #eef2ff; }
        .tense-name { font-weight: 600; }
        .tense-desc { font-size: 0.85rem; color: var(--text-muted); }
        .tense-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 16px;
        }
        .tense-card {
            background: var(--card);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tense-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: var(--shadow-lg); }
        .tense-card h4 { color: var(--primary); margin-bottom: 8px; }
        .formula-box {
            background: #f0fdf4;
            border: 2px solid var(--secondary);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin: 12px 0;
        }
        .formula-row {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            border-bottom: 1px dashed #bbf7d0;
        }
        .formula-row:last-child { border-bottom: none; }
        .formula-label {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .formula-label.pos { background: var(--secondary); color: white; }
        .formula-label.neg { background: var(--danger); color: white; }
        .formula-label.q { background: var(--accent); color: white; }
        .exercise-container { max-width: 600px; margin: 0 auto; }
        .progress-bar {
            height: 8px;
            background: var(--border);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            transition: width 0.3s;
        }
        .question-box {
            background: var(--card);
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        .question-type {
            display: inline-block;
            padding: 4px 12px;
            background: #e0e7ff;
            color: var(--primary);
            border-radius: 20px;
            font-size: 0.8rem;
            margin-bottom: 12px;
        }
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.8;
        }
        .word-builder {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
            min-height: 50px;
            padding: 12px;
            background: var(--bg);
            border-radius: var(--radius-sm);
            border: 2px dashed var(--border);
        }
        .word-builder.filled { border-style: solid; border-color: var(--primary); }
        .word-slot {
            padding: 8px 16px;
            background: white;
            border: 2px solid var(--primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .word-slot:hover { background: #fef3c7; }
        .options-list { display: flex; flex-direction: column; gap: 10px; }
        .option-btn {
            padding: 14px 18px;
            background: var(--bg);
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            cursor: pointer;
            text-align: left;
            font-size: 1rem;
            transition: all 0.2s;
        }
        .option-btn:hover { border-color: var(--primary-light); }
        .option-btn.correct { background: #dcfce7; border-color: var(--secondary); }
        .option-btn.wrong { background: #fee2e2; border-color: var(--danger); }
        .option-btn.selected { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99,102,241,0.2); }
        .answer-input {
            width: 100%;
            padding: 14px 18px;
            font-size: 1.1rem;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            margin-bottom: 12px;
        }
        .answer-input:focus { outline: none; border-color: var(--primary); }
        .feedback {
            padding: 16px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
        }
        .feedback.correct { background: #dcfce7; border: 2px solid var(--secondary); }
        .feedback.wrong { background: #fee2e2; border: 2px solid var(--danger); }
        .feedback-title { font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
        .feedback.correct .feedback-title { color: #166534; }
        .feedback.wrong .feedback-title { color: #991b1b; }
        .hint-box {
            background: #fef3c7;
            border: 2px solid var(--accent);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-top: 16px;
        }
        .hint-title { font-weight: 600; color: #92400e; margin-bottom: 8px; }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: var(--card);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        .stat-label { color: var(--text-muted); font-size: 0.9rem; }
        .stars-display {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 8px;
        }
        .star { font-size: 1.5rem; }
        .star.earned { color: var(--accent); }
        .star.empty { color: var(--border); }
        .week-chart { display: flex; gap: 8px; align-items: flex-end; height: 120px; margin-top: 16px; }
        .day-bar {
            flex: 1;
            background: var(--primary-light);
            border-radius: 4px 4px 0 0;
            min-height: 20px;
            position: relative;
            transition: all 0.2s;
        }
        .day-bar:hover { background: var(--primary); }
        .day-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            color: var(--text-muted);
        }
        .day-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.75rem;
            font-weight: 600;
        }
        .weak-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #fee2e2;
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }
        .weak-item-icon { font-size: 1.5rem; }
        .weak-item-text { flex: 1; }
        .weak-item-count {
            background: var(--danger);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        .parent-toggle {
            text-align: center;
            margin: 20px 0;
        }
        .parent-section {
            background: #f3e8ff;
            border: 2px solid #a855f7;
            border-radius: var(--radius);
            padding: 20px;
        }
        .parent-section h4 { color: #7c3aed; margin-bottom: 12px; }
        .parent-tip {
            background: white;
            padding: 12px;
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
        }
        .tobe-cheat {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #3b82f6;
            border-radius: var(--radius);
            padding: 16px;
            margin-bottom: 16px;
        }
        .tobe-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
        }
        .tobe-table th, .tobe-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #93c5fd;
        }
        .tobe-table th { background: #3b82f6; color: white; }
        .tobe-table td { background: white; }
        .result-summary {
            text-align: center;
            padding: 30px;
        }
        .result-score {
            font-size: 4rem;
            font-weight: 700;
            color: var(--primary);
        }
        .result-message { font-size: 1.2rem; margin: 16px 0; }
        @media (max-width: 600px) {
            .header h1 { font-size: 1.4rem; }
            .nav-btn { min-width: 80px; padding: 10px; font-size: 0.8rem; }
            .tense-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .question-text { font-size: 1rem; }
        }
        .flex { display: flex; }
        .gap-2 { gap: 16px; }
        .mt-2 { margin-top: 16px; }
        .mb-2 { margin-bottom: 16px; }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <div class="header-top">
                <div>
                    <div style="font-size:0.8rem;color:var(--primary);font-weight:600;margin-bottom:4px">üåê –≤—Ä–µ–º–µ–Ω–∞–≤–∞–Ω–≥–ª–∏–π—Å–∫–æ–º.—Ä—Ñ</div>
                    <h1>üéØ Tense Trainer ‚Äî –¢—Ä–µ–Ω–∞–∂–µ—Ä –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º—ë–Ω</h1>
                    <p>–ò–∑—É—á–∞–µ–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤—Ä–µ–º–µ–Ω–∞ –ª–µ–≥–∫–æ –∏ –≤–µ—Å–µ–ª–æ! –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –¥–ª—è –¥–µ—Ç–µ–π 10-12 –ª–µ—Ç</p>
                </div>
                <button class="theme-toggle" onclick="app.toggleTheme()">üåô</button>
            </div>
            <div id="streakDisplay" style="font-size: 0.9rem; opacity: 0.9;"></div>
        </header>

        <!-- Ad Banner -->
        <div class="ad-banner" style="background:var(--card);padding:10px;text-align:center;border-radius:var(--radius);margin-bottom:16px;border:1px dashed var(--border);">
            <p style="color:var(--text-muted);font-size:0.85rem;">üì¢ –ú–µ—Å—Ç–æ –¥–ª—è —Ä–µ–∫–ª–∞–º—ã</p>
            <!-- AdSense ad unit will go here -->
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                 data-ad-slot="YOUR_AD_SLOT"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <nav class="nav">
            <button class="nav-btn active" data-view="home" onclick="app.navigate('home')">üè† –ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-btn" data-view="plan" onclick="app.navigate('plan')">üìã –ü–ª–∞–Ω</button>
            <button class="nav-btn" data-view="tenses" onclick="app.navigate('tenses')">üìö –í—Ä–µ–º–µ–Ω–∞</button>
            <button class="nav-btn" data-view="tobe" onclick="app.navigate('tobe')">üîÑ To Be</button>
            <button class="nav-btn" data-view="stats" onclick="app.navigate('stats')">üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
        </nav>

        <div id="view-home" class="view">
            <div class="card quick-start">
                <h3>‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
                <p>–í—ã–±–µ—Ä–∏ –≥–æ—Ç–æ–≤—ã–π –ø–ª–∞–Ω:</p>
                <div class="preset-btns">
                    <button class="preset-btn" onclick="app.applyPreset('basic')">–ë–∞–∑–∞: Present + Past</button>
                    <button class="preset-btn" onclick="app.applyPreset('simple3')">–¢—Ä–∏ –ø—Ä–æ—Å—Ç—ã—Ö</button>
                    <button class="preset-btn" onclick="app.applyPreset('continuous')">–î–≤–∏–∂–µ–Ω–∏–µ</button>
                    <button class="preset-btn" onclick="app.applyPreset('perfect')">–†–µ–∑—É–ª—å—Ç–∞—Ç</button>
                    <button class="preset-btn" onclick="app.applyPreset('mixed')">–°–º–µ—à–∞–Ω–Ω—ã–π</button>
                </div>
                <button class="btn btn-primary" onclick="app.navigate('plan')">–ò–ª–∏ —Å–æ–∑–¥–∞–π —Å–≤–æ–π –ø–ª–∞–Ω ‚Üí</button>
            </div>
            <div class="card">
                <h4 class="card-title">üìñ –ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –¥–µ–ª–∞—Ç—å:</h4>
                <ul style="margin-left: 20px; line-height: 2;">
                    <li><strong>–ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</strong> ‚Äî –≤—ã–±–µ—Ä–∏ 1-3 –≤—Ä–µ–º–µ–Ω–∞ –¥–ª—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏</li>
                    <li><strong>–í—Å–µ –≤—Ä–µ–º–µ–Ω–∞</strong> ‚Äî –∏–∑—É—á–∏ –ø—Ä–∞–≤–∏–ª–∞ –∏ –ø—Ä–∏–º–µ—Ä—ã</li>
                    <li><strong>To Be Trainer</strong> ‚Äî –ø–æ—Ç—Ä–µ–Ω–∏—Ä—É–π –≥–ª–∞–≥–æ–ª "to be" –æ—Ç–¥–µ–ª—å–Ω–æ</li>
                    <li><strong>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</strong> ‚Äî —Å–ª–µ–¥–∏ –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏ –∑–≤—ë–∑–¥–∞–º–∏</li>
                </ul>
            </div>
            <div class="card" id="todayPlanCard" style="display: none;">
                <h4 class="card-title">‚úÖ –¢–≤–æ–π –ø–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è:</h4>
                <div id="todayPlanContent"></div>
                <button class="btn btn-secondary mt-2" onclick="app.startTraining()">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
            </div>
            <div class="card" id="weakItemsHome" style="display: none;">
                <h4 class="card-title">‚ö†Ô∏è –°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞:</h4>
                <div id="weakItemsHomeContent"></div>
            </div>
        </div>

        <div id="view-plan" class="view hidden">
            <div class="card">
                <h3 class="card-title">üìã –ü–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</h3>
                <p class="mb-2">–í—ã–±–µ—Ä–∏ –¥–æ <strong>3 –≤—Ä–µ–º—ë–Ω</strong>. –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π —Å–µ–±—è! üôÇ</p>
                <div class="checkbox-list" id="tenseCheckboxes"></div>
                <div style="margin-top: 16px; padding: 12px; background: var(--bg); border-radius: var(--radius-sm);">
                    <label class="checkbox-item">
                        <input type="checkbox" id="toBeWarmup" checked>
                        <span>üîÑ –†–∞–∑–º–∏–Ω–∫–∞: TO BE (2 –º–∏–Ω—É—Ç—ã)</span>
                    </label>
                </div>
                <div id="planError" class="feedback wrong hidden mt-2">
                    <div class="feedback-title">‚ö†Ô∏è –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ!</div>
                    <div class="feedback-explanation">–î–∞–≤–∞–π –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å—Å—è üôÇ –í—ã–±–µ—Ä–∏ –¥–æ 3 –≤—Ä–µ–º—ë–Ω.</div>
                </div>
                <div class="flex gap-2 mt-2">
                    <button class="btn btn-primary" onclick="app.savePlan()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–ª–∞–Ω</button>
                    <button class="btn btn-outline" onclick="app.navigate('home')">–û—Ç–º–µ–Ω–∞</button>
                </div>
            </div>
            <div class="card" id="currentPlanCard" style="display: none;">
                <h4>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ <span id="planDate"></span>:</h4>
                <div id="savedPlanContent"></div>
                <button class="btn btn-secondary mt-2" onclick="app.startTraining()">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button>
            </div>
        </div>

        <div id="view-tenses" class="view hidden">
            <div class="card">
                <h3 class="card-title">üìö –í—Å–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤—Ä–µ–º–µ–Ω–∞</h3>
                <p class="mb-2">–ù–∞–∂–º–∏ –Ω–∞ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –∏–∑—É—á–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞:</p>
                <div class="tense-grid" id="tensesGrid"></div>
            </div>
        </div>

        <div id="view-tense-detail" class="view hidden">
            <div class="card">
                <button class="btn btn-outline btn-sm mb-2" onclick="app.navigate('tenses')">‚Üê –ù–∞–∑–∞–¥</button>
                <h2 id="detailTitle" class="card-title"></h2>
                <p id="detailUse" class="mb-2"></p>
                <div class="formula-box">
                    <h4 style="margin-bottom: 12px; color: #166534;">üìê –§–æ—Ä–º—É–ª—ã:</h4>
                    <div id="detailFormulas"></div>
                </div>
                <div class="card" style="background: #fef3c7;">
                    <h4 style="color: #92400e; margin-bottom: 12px;">üîî –°–∏–≥–Ω–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞:</h4>
                    <div id="detailSignals"></div>
                </div>
                <div class="card">
                    <h4 class="card-title">üìù –ü—Ä–∏–º–µ—Ä—ã:</h4>
                    <div id="detailExamples"></div>
                </div>
                <button class="btn btn-primary" id="trainThisBtn">‚ñ∂Ô∏è –¢—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            </div>
        </div>

        <div id="view-tobe" class="view hidden">
            <div class="card">
                <h3 class="card-title">üîÑ To Be Trainer</h3>
                <p class="mb-2">–ì–ª–∞–≥–æ–ª <strong>to be</strong> ‚Äî —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π! –ü–æ—Ç—Ä–µ–Ω–∏—Ä—É–π—Å—è:</p>
                <div class="tobe-cheat">
                    <h4>üìñ –®–ø–∞—Ä–≥–∞–ª–∫–∞:</h4>
                    <table class="tobe-table">
                        <tr><th></th><th>I</th><th>you/we/they</th><th>he/she/it</th></tr>
                        <tr><td><strong>Present</strong></td><td>am</td><td>are</td><td>is</td></tr>
                        <tr><td><strong>Past</strong></td><td>was</td><td>were</td><td>was</td></tr>
                    </table>
                    <p style="margin-top: 12px; font-size: 0.9rem;">
                        üí° <strong>–ü—Ä–∞–≤–∏–ª–æ:</strong> I ‚Üí am, he/she/it ‚Üí is, you/we/they ‚Üí are
                    </p>
                </div>
                <div class="flex gap-2 mb-2">
                    <button class="btn btn-primary" onclick="app.startToBeTraining('quick')">‚ö° –ë—ã—Å—Ç—Ä–∞—è (2 –º–∏–Ω)</button>
                    <button class="btn btn-secondary" onclick="app.startToBeTraining('full')">üéØ –ü–æ–ª–Ω–∞—è (5 –º–∏–Ω)</button>
                </div>
            </div>
            <div class="card" id="tobeStatsCard">
                <h4 class="card-title">üìä –¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å –ø–æ To Be:</h4>
                <div id="tobeStatsContent"></div>
            </div>
        </div>

        <div id="view-train" class="view hidden">
            <div class="exercise-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                </div>
                <div class="question-box">
                    <span class="question-type" id="questionType"></span>
                    <div class="question-text" id="questionText"></div>
                    <div id="wordBuilderContainer" class="hidden">
                        <p class="mb-1">–°–æ–±–µ—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:</p>
                        <div class="word-builder" id="wordBuilder"></div>
                        <div class="word-builder" id="wordBank"></div>
                    </div>
                    <div id="optionsContainer" class="hidden">
                        <div class="options-list" id="optionsList"></div>
                    </div>
                    <div id="inputContainer" class="hidden">
                        <input type="text" class="answer-input" id="answerInput" placeholder="–í–≤–µ–¥–∏ –æ—Ç–≤–µ—Ç...">
                    </div>
                    <div id="feedbackBox" class="hidden"></div>
                    <div id="hintBox" class="hint-box hidden">
                        <div class="hint-title">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</div>
                        <div id="hintContent"></div>
                    </div>
                    <div id="miniCheat" class="tobe-cheat hidden">
                        <div class="hint-title">üìñ –ú–∏–Ω–∏-—à–ø–∞—Ä–≥–∞–ª–∫–∞:</div>
                        <div id="miniCheatContent"></div>
                    </div>
                </div>
                <div class="flex gap-2" id="actionButtons">
                    <button class="btn btn-primary" id="checkBtn" onclick="app.checkAnswer()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    <button class="btn btn-outline" id="hintBtn" onclick="app.showHint()">üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞</button>
                    <button class="btn btn-secondary hidden" id="nextBtn" onclick="app.nextQuestion()">–î–∞–ª—å—à–µ ‚Üí</button>
                </div>
            </div>
        </div>

        <div id="view-result" class="view hidden">
            <div class="card">
                <div class="result-summary">
                    <div class="result-score" id="resultScore">0%</div>
                    <div class="result-message" id="resultMessage"></div>
                    <div id="resultStars" class="stars-display mb-2"></div>
                    <div id="resultDetails"></div>
                </div>
                <div id="weakItemsResult" class="hidden">
                    <h4 class="card-title">‚ö†Ô∏è –ù–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ:</h4>
                    <div id="weakItemsList"></div>
                </div>
                <div class="flex gap-2 mt-2" style="justify-content: center;">
                    <button class="btn btn-primary" onclick="app.startTraining()">üîÑ –ï—â—ë —Ä–∞–∑</button>
                    <button class="btn btn-secondary" onclick="app.navigate('plan')">üìã –ù–æ–≤—ã–π –ø–ª–∞–Ω</button>
                    <button class="btn btn-outline" onclick="app.navigate('home')">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>
            </div>
        </div>

        <div id="view-stats" class="view hidden">
            <div class="card">
                <h3 class="card-title">üìä –¢–≤–æ—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="statTotalQuestions">0</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statAccuracy">0%</div>
                        <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statStars">0</div>
                        <div class="stat-label">–ó–≤—ë–∑–¥</div>
                        <div class="stars-display" id="starsDisplay"></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statStreak">0</div>
                        <div class="stat-label">–î–Ω–µ–π –ø–æ–¥—Ä—è–¥</div>
                    </div>
                </div>
                <div class="card">
                    <h4 class="card-title">üìÖ –ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:</h4>
                    <div class="week-chart" id="weekChart"></div>
                </div>
                <div class="card" id="weakItemsStats">
                    <h4 class="card-title">‚ö†Ô∏è –°–ª–∞–±—ã–µ –º–µ—Å—Ç–∞:</h4>
                    <div id="weakItemsStatsContent"></div>
                </div>
                <div class="flex gap-2">
                    <button class="btn btn-outline" onclick="app.exportStats()">üìã –≠–∫—Å–ø–æ—Ä—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</button>
                    <button class="btn btn-danger btn-sm" onclick="app.resetStats()">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë</button>
                </div>
            </div>

            <!-- Sidebar Ad -->
            <div class="card" style="text-align:center;padding:16px;">
                <p style="color:var(--text-muted);font-size:0.85rem;margin-bottom:8px;">üì¢ –†–µ–∫–ª–∞–º–∞</p>
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-YOUR_PUBLISHER_ID"
                     data-ad-slot="YOUR_AD_SLOT_2"
                     data-ad-format="rectangle"
                     data-full-width-responsive="true"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>

            <div class="parent-toggle">
                <button class="btn btn-outline btn-sm" onclick="app.toggleParentMode()">üë®‚Äçüë©‚Äçüëß –î–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π</button>
            </div>
            <div id="parentSection" class="parent-section hidden">
                <h4>üë®‚Äçüë©‚Äçüëß –°–æ–≤–µ—Ç—ã –¥–ª—è —Ä–æ–¥–∏—Ç–µ–ª–µ–π</h4>
                <div class="parent-tip">
                    <strong>üìã –ö–∞–∫ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–ª–∞–Ω:</strong><br>
                    –í—ã–±–∏—Ä–∞–π—Ç–µ –º–∞–∫—Å–∏–º—É–º 2-3 –≤—Ä–µ–º–µ–Ω–∏ –∑–∞ —Ä–∞–∑. –õ—É—á—à–µ —É—á–∏—Ç—å –º–µ–Ω—å—à–µ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ!
                </div>
                <div class="parent-tip">
                    <strong>‚è±Ô∏è –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è:</strong><br>
                    10-15 –º–∏–Ω—É—Ç –≤ –¥–µ–Ω—å ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–µ–±—ë–Ω–∫–∞ 10-12 –ª–µ—Ç.
                </div>
                <div class="parent-tip">
                    <strong>üí™ –ö–∞–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:</strong><br>
                    –•–≤–∞–ª–∏—Ç–µ –∑–∞ –ø–æ–ø—ã—Ç–∫–∏, –Ω–µ —Ä—É–≥–∞–π—Ç–µ –∑–∞ –æ—à–∏–±–∫–∏. –û—à–∏–±–∫–∏ ‚Äî —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!
                </div>
                <div class="parent-tip">
                    <strong>üéØ –†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ:</strong><br>
                    –õ—É—á—à–µ 10 –º–∏–Ω—É—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å, —á–µ–º —á–∞—Å —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.
                </div>
            </div>
        </div>
    </div>

<script>
const TENSES_DATA={
present_simple:{
id:'present_simple',nameRu:'Present Simple',nameEn:'–ù–∞—Å—Ç–æ—è—â–µ–µ –ø—Ä–æ—Å—Ç–æ–µ',
useCases:['–î–ª—è –ø—Ä–∏–≤—ã—á–µ–∫: I play every day','–î–ª—è —Ñ–∞–∫—Ç–æ–≤: Water boils at 100¬∞','–î–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π: The train leaves at 5'],
formulas:{
affirmative:'I/you/we/they + V1 (I play, I go) | he/she/it + V1+s/es (he plays, he goes)',
negative:'I/you/we/they + don\'t + V1 (don\'t play/go) | he/she/it + doesn\'t + V1 (doesn\'t play/go)',
question:'Do + I/you/we/they + V1? (Do you play/go?) | Does + he/she/it + V1? (Does he play/go?)',
shortAnswers:'Yes, I do. / No, I don\'t. | Yes, he does. / No, he doesn\'t.'},
signalWords:['every day','always','usually','often','sometimes','never','on Mondays'],
examples:[
{en:'I play Minecraft every day.',ru:'–Ø –∏–≥—Ä–∞—é –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.'},
{en:'She likes pizza.',ru:'–ï–π –Ω—Ä–∞–≤–∏—Ç—Å—è –ø–∏—Ü—Ü–∞.'},
{en:'We go to school on Mondays.',ru:'–ú—ã —Ö–æ–¥–∏–º –≤ —à–∫–æ–ª—É –ø–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞–º.'},
{en:'He doesn\'t watch TV.',ru:'–û–Ω –Ω–µ —Å–º–æ—Ç—Ä–∏—Ç —Ç–µ–ª–µ–≤–∏–∑–æ—Ä.'},
{en:'Do they play football?',ru:'–û–Ω–∏ –∏–≥—Ä–∞—é—Ç –≤ —Ñ—É—Ç–±–æ–ª?'}],
templates:{
wordOrder:[
{words:['She','plays','games','every','day'],answer:'She plays games every day.'},
{words:['Do','you','like','pizza','?'],answer:'Do you like pizza?'},
{words:['He','doesn\'t','watch','TV'],answer:'He doesn\'t watch TV.'}],
multipleChoice:[
{question:'I ___ football every day.',options:['play','plays','playing'],answer:'play',hint:'I ‚Üí –±–µ–∑ –æ–∫–æ–Ω—á–∞–Ω–∏—è'},
{question:'She ___ to school every day.',options:['go','goes','going'],answer:'goes',hint:'She ‚Üí –¥–æ–±–∞–≤–ª—è–µ–º -es'}],
makeQuestion:[
{sentence:'You play games.',answer:'Do you play games?',hint:'Do + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + –≥–ª–∞–≥–æ–ª?'},
{sentence:'He likes pizza.',answer:'Does he like pizza?',hint:'Does + he/she/it + –≥–ª–∞–≥–æ–ª?'}],
makeNegative:[
{sentence:'I play games.',answer:'I don\'t play games.',hint:'don\'t –¥–ª—è I/you/we/they'},
{sentence:'She watches TV.',answer:'She doesn\'t watch TV.',hint:'doesn\'t –¥–ª—è he/she/it'}],
fillBlank:[
{sentence:'We ___ to school every day.',answer:'go',hint:'we ‚Üí –±–µ–∑ –æ–∫–æ–Ω—á–∞–Ω–∏—è'},
{sentence:'___ he like pizza?',answer:'Does',hint:'he ‚Üí Does'}],
findError:[
{sentence:'She don\'t like pizza.',correct:'She doesn\'t like pizza.',hint:'She ‚Üí doesn\'t'},
{sentence:'He play games.',correct:'He plays games.',hint:'He ‚Üí plays'}]
}},
past_simple:{
id:'past_simple',nameRu:'Past Simple',nameEn:'–ü—Ä–æ—à–µ–¥—à–µ–µ –ø—Ä–æ—Å—Ç–æ–µ',
useCases:['–î–ª—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π: I played yesterday','–î–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π','–î–ª—è —Ñ–∞–∫—Ç–æ–≤ –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ'],
formulas:{
affirmative:'–í—Å–µ + V2 (–∏–ª–∏ +ed)',
negative:'–í—Å–µ + didn\'t + V1',
question:'Did + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V1?',
shortAnswers:'Yes, I did. / No, I didn\'t.'},
signalWords:['yesterday','last week','last year','ago','in 2020','then'],
examples:[
{en:'I played Minecraft yesterday.',ru:'–Ø –∏–≥—Ä–∞–ª –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç –≤—á–µ—Ä–∞.'},
{en:'She went to school last Monday.',ru:'–û–Ω–∞ –ø–æ—à–ª–∞ –≤ —à–∫–æ–ª—É –≤ –ø—Ä–æ—à–ª—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫.'},
{en:'We didn\'t watch TV.',ru:'–ú—ã –Ω–µ —Å–º–æ—Ç—Ä–µ–ª–∏ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä.'},
{en:'Did they win the game?',ru:'–û–Ω–∏ –≤—ã–∏–≥—Ä–∞–ª–∏ –∏–≥—Ä—É?'}],
templates:{
wordOrder:[
{words:['I','played','games','yesterday'],answer:'I played games yesterday.'},
{words:['Did','you','go','to','school','?'],answer:'Did you go to school?'}],
multipleChoice:[
{question:'I ___ to school yesterday.',options:['go','went','gone'],answer:'went',hint:'go ‚Üí went'},
{question:'She ___ TV last night.',options:['watch','watched','watching'],answer:'watched',hint:'–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–ª–∞–≥–æ–ª ‚Üí +ed'}],
makeQuestion:[{sentence:'You played games.',answer:'Did you play games?',hint:'Did + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V1?'}],
makeNegative:[{sentence:'I went to school.',answer:'I didn\'t go to school.',hint:'didn\'t + V1'}],
fillBlank:[
{sentence:'We ___ football yesterday.',answer:'played',hint:'–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≥–ª–∞–≥–æ–ª ‚Üí +ed'},
{sentence:'___ she go home yesterday?',answer:'Did',hint:'–í–æ–ø—Ä–æ—Å –≤ Past Simple ‚Üí Did'}],
findError:[{sentence:'I didn\'t went to school.',correct:'I didn\'t go to school.',hint:'didn\'t + V1 (–Ω–µ V2!)'}]
}},
future_simple:{
id:'future_simple',nameRu:'Future Simple',nameEn:'–ë—É–¥—É—â–µ–µ –ø—Ä–æ—Å—Ç–æ–µ',
useCases:['–î–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π: It will rain tomorrow','–î–ª—è —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π','–î–ª—è –æ–±–µ—â–∞–Ω–∏–π'],
formulas:{
affirmative:'–í—Å–µ + will + V1 (will play/go)',
negative:'–í—Å–µ + won\'t + V1 (won\'t play/go)',
question:'Will + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V1? (Will you play/go?)',
shortAnswers:'Yes, I will. / No, I won\'t.'},
signalWords:['tomorrow','next week','next year','soon','later','in the future'],
examples:[
{en:'I will play Minecraft tomorrow.',ru:'–Ø –±—É–¥—É –∏–≥—Ä–∞—Ç—å –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç –∑–∞–≤—Ç—Ä–∞.'},
{en:'She won\'t go to school on Sunday.',ru:'–û–Ω–∞ –Ω–µ –ø–æ–π–¥—ë—Ç –≤ —à–∫–æ–ª—É –≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ.'},
{en:'Will they win the game?',ru:'–û–Ω–∏ –≤—ã–∏–≥—Ä–∞—é—Ç –∏–≥—Ä—É?'}],
templates:{
wordOrder:[
{words:['I','will','play','tomorrow'],answer:'I will play tomorrow.'},
{words:['Will','you','go','to','school','?'],answer:'Will you go to school?'}],
multipleChoice:[
{question:'I ___ play tomorrow.',options:['will','would','wills'],answer:'will',hint:'will –¥–ª—è –≤—Å–µ—Ö'},
{question:'She ___ to school tomorrow.',options:['won\'t go','willn\'t go','not will go'],answer:'won\'t go',hint:'won\'t = will not'}],
makeQuestion:[{sentence:'You will play games.',answer:'Will you play games?',hint:'Will + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V1?'}],
makeNegative:[{sentence:'I will go to school.',answer:'I won\'t go to school.',hint:'won\'t = will not'}],
fillBlank:[
{sentence:'We ___ win the game.',answer:'will',hint:'will –¥–ª—è –≤—Å–µ—Ö'},
{sentence:'___ they come tomorrow?',answer:'Will',hint:'–í–æ–ø—Ä–æ—Å ‚Üí Will'}],
findError:[{sentence:'I will plays tomorrow.',correct:'I will play tomorrow.',hint:'will + V1 (–±–µ–∑ s!)'}]
}},
present_continuous:{
id:'present_continuous',nameRu:'Present Continuous',nameEn:'–ù–∞—Å—Ç–æ—è—â–µ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–Ω–æ–µ',
useCases:['–î–ª—è –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å','–î–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏–π','–î–ª—è –ø–ª–∞–Ω–æ–≤ –≤ –±—É–¥—É—â–µ–º'],
formulas:{
affirmative:'I + am + V-ing (am playing/going) | he/she/it + is + V-ing (is playing/going) | you/we/they + are + V-ing (are playing/going)',
negative:'I\'m not + V-ing (am not playing/going) | he/she/it + isn\'t + V-ing (isn\'t playing/going) | you/we/they + aren\'t + V-ing (aren\'t playing/going)',
question:'Am I + V-ing? (Am I playing?) | Is he/she/it + V-ing? (Is he playing?) | Are you/we/they + V-ing? (Are you playing?)',
shortAnswers:'Yes, I am. / No, I\'m not. | Yes, he is. / No, he isn\'t.'},
signalWords:['now','at the moment','right now','today','look!','listen!'],
examples:[
{en:'I am playing Minecraft now.',ru:'–Ø –∏–≥—Ä–∞—é –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç —Å–µ–π—á–∞—Å.'},
{en:'She is watching TV at the moment.',ru:'–û–Ω–∞ —Å–º–æ—Ç—Ä–∏—Ç —Ç–µ–ª–µ–≤–∏–∑–æ—Ä –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.'},
{en:'They aren\'t studying.',ru:'–û–Ω–∏ –Ω–µ —É—á–∞—Ç—Å—è.'},
{en:'Are you playing games?',ru:'–¢—ã –∏–≥—Ä–∞–µ—à—å –≤ –∏–≥—Ä—ã?'}],
templates:{
wordOrder:[
{words:['I','am','playing','now'],answer:'I am playing now.'},
{words:['Are','you','watching','TV','?'],answer:'Are you watching TV?'}],
multipleChoice:[
{question:'I ___ playing now.',options:['am','is','are'],answer:'am',hint:'I ‚Üí am'},
{question:'She ___ watching TV now.',options:['am','is','are'],answer:'is',hint:'she ‚Üí is'}],
makeQuestion:[{sentence:'You are playing games.',answer:'Are you playing games?',hint:'Are + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V-ing?'}],
makeNegative:[{sentence:'I am playing games.',answer:'I\'m not playing games.',hint:'I\'m not'}],
fillBlank:[
{sentence:'We ___ studying now.',answer:'are',hint:'we ‚Üí are'},
{sentence:'___ he sleeping?',answer:'Is',hint:'he ‚Üí Is'}],
findError:[{sentence:'He am playing.',correct:'He is playing.',hint:'he ‚Üí is (–Ω–µ am!)'}]
}},
past_continuous:{
id:'past_continuous',nameRu:'Past Continuous',nameEn:'–ü—Ä–æ—à–µ–¥—à–µ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–Ω–æ–µ',
useCases:['–î–ª—è –¥–µ–π—Å—Ç–≤–∏–π –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø—Ä–æ—à–ª–æ–≥–æ','–î–ª—è –¥–µ–π—Å—Ç–≤–∏–π, –ø—Ä–µ—Ä–≤–∞–Ω–Ω—ã—Ö –¥—Ä—É–≥–∏–º','–î–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π'],
formulas:{
affirmative:'I/he/she/it + was + V-ing (was playing/going) | you/we/they + were + V-ing (were playing/going)',
negative:'I/he/she/it + wasn\'t + V-ing (wasn\'t playing/going) | you/we/they + weren\'t + V-ing (weren\'t playing/going)',
question:'Was I/he/she/it + V-ing? (Was he playing?) | Were you/we/they + V-ing? (Were you playing?)',
shortAnswers:'Yes, I was. / No, I wasn\'t.'},
signalWords:["at 5 o'clock",'at that moment','while','when'],
examples:[
{en:'I was playing Minecraft at 5 pm.',ru:'–Ø –∏–≥—Ä–∞–ª –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç –≤ 5 –≤–µ—á–µ—Ä–∞.'},
{en:'She was watching TV when I called.',ru:'–û–Ω–∞ —Å–º–æ—Ç—Ä–µ–ª–∞ —Ç–µ–ª–µ–≤–∏–∑–æ—Ä, –∫–æ–≥–¥–∞ —è –ø–æ–∑–≤–æ–Ω–∏–ª.'},
{en:'They weren\'t studying.',ru:'–û–Ω–∏ –Ω–µ —É—á–∏–ª–∏—Å—å.'},
{en:'Were you playing games?',ru:'–¢—ã –∏–≥—Ä–∞–ª –≤ –∏–≥—Ä—ã?'}],
templates:{
wordOrder:[
{words:['I','was','playing','at','5'],answer:'I was playing at 5.'},
{words:['Were','you','watching','TV','?'],answer:'Were you watching TV?'}],
multipleChoice:[
{question:'I ___ playing at 5 yesterday.',options:['was','were','am'],answer:'was',hint:'I ‚Üí was'},
{question:'They ___ studying yesterday.',options:['was','were','are'],answer:'were',hint:'they ‚Üí were'}],
makeQuestion:[{sentence:'You were playing games.',answer:'Were you playing games?',hint:'Were + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V-ing?'}],
makeNegative:[{sentence:'I was playing games.',answer:'I wasn\'t playing games.',hint:'wasn\'t'}],
fillBlank:[
{sentence:'We ___ playing football.',answer:'were',hint:'we ‚Üí were'},
{sentence:'___ he sleeping?',answer:'Was',hint:'he ‚Üí Was'}],
findError:[{sentence:'He were playing.',correct:'He was playing.',hint:'he ‚Üí was (–Ω–µ were!)'}]
}},
future_continuous:{
id:'future_continuous',nameRu:'Future Continuous',nameEn:'–ë—É–¥—É—â–µ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–Ω–æ–µ',
useCases:['–î–ª—è –¥–µ–π—Å—Ç–≤–∏–π –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç –±—É–¥—É—â–µ–≥–æ','–î–ª—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π'],
formulas:{
affirmative:'–í—Å–µ + will be + V-ing (will be playing/going)',
negative:'–í—Å–µ + won\'t be + V-ing (won\'t be playing/going)',
question:'Will + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + be + V-ing? (Will you be playing?)',
shortAnswers:'Yes, I will. / No, I won\'t.'},
signalWords:['at this time tomorrow','at 5 pm tomorrow'],
examples:[
{en:'I will be playing Minecraft at 5 pm tomorrow.',ru:'–Ø –±—É–¥—É –∏–≥—Ä–∞—Ç—å –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç –∑–∞–≤—Ç—Ä–∞ –≤ 5 –≤–µ—á–µ—Ä–∞.'},
{en:'She will be waiting for you.',ru:'–û–Ω–∞ –±—É–¥–µ—Ç –∂–¥–∞—Ç—å —Ç–µ–±—è.'}],
templates:{
wordOrder:[{words:['I','will','be','playing','tomorrow'],answer:'I will be playing tomorrow.'}],
multipleChoice:[{question:'I ___ be playing tomorrow.',options:['will','would','was'],answer:'will',hint:'will be + V-ing'}],
makeQuestion:[{sentence:'You will be playing games.',answer:'Will you be playing games?',hint:'Will + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + be + V-ing?'}],
makeNegative:[{sentence:'I will be playing games.',answer:'I won\'t be playing games.',hint:'won\'t be'}],
fillBlank:[{sentence:'We ___ be studying tomorrow.',answer:'will',hint:'will be'}],
findError:[{sentence:'I will playing tomorrow.',correct:'I will be playing tomorrow.',hint:'will BE + V-ing'}]
}},
present_perfect:{
id:'present_perfect',nameRu:'Present Perfect',nameEn:'–ù–∞—Å—Ç–æ—è—â–µ–µ —Å–æ–≤–µ—Ä—à—ë–Ω–Ω–æ–µ',
useCases:['–î–ª—è –æ–ø—ã—Ç–∞ –≤ –∂–∏–∑–Ω–∏','–î–ª—è –Ω–µ–¥–∞–≤–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º','–î–ª—è –¥–µ–π—Å—Ç–≤–∏–π, –Ω–∞—á–∞–≤—à–∏—Ö—Å—è –≤ –ø—Ä–æ—à–ª–æ–º'],
formulas:{
affirmative:'I/you/we/they + have + V3 (have played/gone) | he/she/it + has + V3 (has played/gone)',
negative:'I/you/we/they + haven\'t + V3 (haven\'t played/gone) | he/she/it + hasn\'t + V3 (hasn\'t played/gone)',
question:'Have + I/you/we/they + V3? (Have you played/gone?) | Has + he/she/it + V3? (Has he played/gone?)',
shortAnswers:'Yes, I have. / No, I haven\'t. | Yes, he has. / No, he hasn\'t.'},
signalWords:['already','yet','just','ever','never','since','for'],
examples:[
{en:'I have played Minecraft before.',ru:'–Ø –∏–≥—Ä–∞–ª –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç —Ä–∞–Ω—å—à–µ.'},
{en:'She has just finished homework.',ru:'–û–Ω–∞ —Ç–æ–ª—å–∫–æ —á—Ç–æ –∑–∞–∫–æ–Ω—á–∏–ª–∞ –¥–æ–º–∞—à–∫—É.'},
{en:'They haven\'t won yet.',ru:'–û–Ω–∏ –µ—â—ë –Ω–µ –≤—ã–∏–≥—Ä–∞–ª–∏.'},
{en:'Have you ever been to London?',ru:'–¢—ã –∫–æ–≥–¥–∞-–Ω–∏–±—É–¥—å –±—ã–ª –≤ –õ–æ–Ω–¥–æ–Ω–µ?'}],
templates:{
wordOrder:[
{words:['I','have','played','before'],answer:'I have played before.'},
{words:['Has','she','finished','?'],answer:'Has she finished?'}],
multipleChoice:[
{question:'I ___ played before.',options:['have','has','had'],answer:'have',hint:'I ‚Üí have'},
{question:'She ___ just arrived.',options:['have','has','had'],answer:'has',hint:'she ‚Üí has'}],
makeQuestion:[{sentence:'You have played games.',answer:'Have you played games?',hint:'Have + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V3?'}],
makeNegative:[{sentence:'I have played games.',answer:'I haven\'t played games.',hint:'haven\'t'}],
fillBlank:[
{sentence:'We ___ finished yet.',answer:'haven\'t',hint:'haven\'t + V3'},
{sentence:'___ he arrived?',answer:'Has',hint:'he ‚Üí Has'}],
findError:[{sentence:'He have played.',correct:'He has played.',hint:'he ‚Üí has (–Ω–µ have!)'}]
}},
past_perfect:{
id:'past_perfect',nameRu:'Past Perfect',nameEn:'–ü—Ä–æ—à–µ–¥—à–µ–µ —Å–æ–≤–µ—Ä—à—ë–Ω–Ω–æ–µ',
useCases:['–î–ª—è –¥–µ–π—Å—Ç–≤–∏–π, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö—Å—è –¥–æ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ—à–ª–æ–≥–æ','–î–ª—è –ø—Ä–∏—á–∏–Ω –≤ –ø—Ä–æ—à–ª–æ–º'],
formulas:{
affirmative:'–í—Å–µ + had + V3 (had played/gone)',
negative:'–í—Å–µ + hadn\'t + V3 (hadn\'t played/gone)',
question:'Had + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V3? (Had you played/gone?)',
shortAnswers:'Yes, I had. / No, I hadn\'t.'},
signalWords:['before','after','by the time'],
examples:[
{en:'I had finished homework before dinner.',ru:'–Ø –∑–∞–∫–æ–Ω—á–∏–ª –¥–æ–º–∞—à–∫—É –¥–æ —É–∂–∏–Ω–∞.'},
{en:'She had never played Minecraft before.',ru:'–û–Ω–∞ –Ω–∏–∫–æ–≥–¥–∞ —Ä–∞–Ω—å—à–µ –Ω–µ –∏–≥—Ä–∞–ª–∞ –≤ –ú–∞–π–Ω–∫—Ä–∞—Ñ—Ç.'}],
templates:{
wordOrder:[{words:['I','had','finished','before'],answer:'I had finished before.'}],
multipleChoice:[{question:'I ___ finished before.',options:['had','have','has'],answer:'had',hint:'had + V3'}],
makeQuestion:[{sentence:'You had played games.',answer:'Had you played games?',hint:'Had + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + V3?'}],
makeNegative:[{sentence:'I had played games.',answer:'I hadn\'t played games.',hint:'hadn\'t'}],
fillBlank:[{sentence:'We ___ left before him.',answer:'had',hint:'had + V3'}],
findError:[{sentence:'I have finished before he came.',correct:'I had finished before he came.',hint:'Past Perfect ‚Üí had'}]
}},
future_perfect:{
id:'future_perfect',nameRu:'Future Perfect',nameEn:'–ë—É–¥—É—â–µ–µ —Å–æ–≤–µ—Ä—à—ë–Ω–Ω–æ–µ',
useCases:['–î–ª—è –¥–µ–π—Å—Ç–≤–∏–π, –∑–∞–≤–µ—Ä—à–∏–≤—à–∏—Ö—Å—è –∫ –º–æ–º–µ–Ω—Ç—É –≤ –±—É–¥—É—â–µ–º'],
formulas:{
affirmative:'–í—Å–µ + will have + V3 (will have played/gone)',
negative:'–í—Å–µ + won\'t have + V3 (won\'t have played/gone)',
question:'Will + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + have + V3? (Will you have played/gone?)',
shortAnswers:'Yes, I will. / No, I won\'t.'},
signalWords:['by','by the time','before'],
examples:[
{en:'I will have finished homework by 8 pm.',ru:'–Ø –∑–∞–∫–æ–Ω—á—É –¥–æ–º–∞—à–∫—É –∫ 8 –≤–µ—á–µ—Ä–∞.'},
{en:'She will have left before you arrive.',ru:'–û–Ω–∞ —É–π–¥—ë—Ç –¥–æ —Ç–≤–æ–µ–≥–æ –ø—Ä–∏—Ö–æ–¥–∞.'}],
templates:{
wordOrder:[{words:['I','will','have','finished','by','5'],answer:'I will have finished by 5.'}],
multipleChoice:[{question:'I ___ have finished by 5.',options:['will','would','was'],answer:'will',hint:'will have + V3'}],
makeQuestion:[{sentence:'You will have played games.',answer:'Will you have played games?',hint:'Will + –ø–æ–¥–ª–µ–∂–∞—â–µ–µ + have + V3?'}],
makeNegative:[{sentence:'I will have played games.',answer:'I won\'t have played games.',hint:'won\'t have'}],
fillBlank:[{sentence:'We ___ have left by then.',answer:'will',hint:'will have'}],
findError:[{sentence:'I will has finished by 5.',correct:'I will have finished by 5.',hint:'will HAVE + V3'}]
}}
};

const TOBE_EXERCISES={
present:[
{type:'choose',question:'I ___ happy today.',options:['am','is','are'],correctAnswer:'am',hint:'I ‚Üí am'},
{type:'choose',question:'He ___ ready now.',options:['am','is','are'],correctAnswer:'is',hint:'he ‚Üí is'},
{type:'choose',question:'She ___ at school today.',options:['am','is','are'],correctAnswer:'is',hint:'she ‚Üí is'},
{type:'choose',question:'It ___ big.',options:['am','is','are'],correctAnswer:'is',hint:'it ‚Üí is'},
{type:'choose',question:'You ___ kind.',options:['am','is','are'],correctAnswer:'are',hint:'you ‚Üí are'},
{type:'choose',question:'We ___ friends now.',options:['am','is','are'],correctAnswer:'are',hint:'we ‚Üí are'},
{type:'choose',question:'They ___ here today.',options:['am','is','are'],correctAnswer:'are',hint:'they ‚Üí are'},
{type:'fill',question:'I ___ at home now.',correctAnswer:'am',hint:'I ‚Üí am'},
{type:'fill',question:'He ___ okay today.',correctAnswer:'is',hint:'he ‚Üí is'},
{type:'fill',question:'We ___ ready now.',correctAnswer:'are',hint:'we ‚Üí are'},
{type:'question',question:'___ you ready now?',options:['Are','Is','Am'],correctAnswer:'Are',hint:'you ‚Üí Are'},
{type:'question',question:'___ he okay today?',options:['Are','Is','Am'],correctAnswer:'Is',hint:'he ‚Üí Is'},
{type:'negative',question:'I ___ (not) tired today.',correctAnswer:'am not',hint:'I am not'},
{type:'negative',question:'He ___ (not) here now.',correctAnswer:'is not',short:"isn't",hint:"He is not / He isn't"},
{type:'translate',question:'–Ø –¥–æ–º–∞ —Å–µ–π—á–∞—Å.',correctAnswer:'I am at home now',hint:'I am at home now'},
{type:'translate',question:'–û–Ω –≥–æ—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è.',correctAnswer:'He is ready today',hint:'He is ready today'},
{type:'translate',question:'–ú—ã –≤ —à–∫–æ–ª–µ —Å–µ–π—á–∞—Å.',correctAnswer:'We are at school now',hint:'We are at school now'},
{type:'translate',question:'–û–Ω–∏ –∑–¥–µ—Å—å —Å–µ–≥–æ–¥–Ω—è.',correctAnswer:'They are here today',hint:'They are here today'}
],
past:[
{type:'choose',question:'I ___ happy yesterday.',options:['was','were'],correctAnswer:'was',hint:'I ‚Üí was'},
{type:'choose',question:'He ___ at school yesterday.',options:['was','were'],correctAnswer:'was',hint:'he ‚Üí was'},
{type:'choose',question:'They ___ here yesterday.',options:['was','were'],correctAnswer:'were',hint:'they ‚Üí were'},
{type:'choose',question:'We ___ friends last year.',options:['was','were'],correctAnswer:'were',hint:'we ‚Üí were'},
{type:'fill',question:'She ___ tired yesterday.',correctAnswer:'was',hint:'she ‚Üí was'},
{type:'fill',question:'You ___ late yesterday.',correctAnswer:'were',hint:'you ‚Üí were'},
{type:'question',question:'___ you there yesterday?',options:['Were','Was'],correctAnswer:'Were',hint:'you ‚Üí Were'},
{type:'question',question:'___ he okay yesterday?',options:['Were','Was'],correctAnswer:'Was',hint:'he ‚Üí Was'},
{type:'negative',question:'I ___ (not) there yesterday.',correctAnswer:'was not',short:"wasn't",hint:"was not / wasn't"},
{type:'translate',question:'–Ø –±—ã–ª –¥–æ–º–∞ –≤—á–µ—Ä–∞.',correctAnswer:'I was at home yesterday',hint:'I was at home yesterday'},
{type:'translate',question:'–û–Ω–∏ –±—ã–ª–∏ –≤ —à–∫–æ–ª–µ –≤—á–µ—Ä–∞.',correctAnswer:'They were at school yesterday',hint:'They were at school yesterday'}
]
};

const state={
currentView:'home',
todayPlan:null,
session:{
active:false,
questions:[],
currentIndex:0,
correct:0,
wrong:0,
consecutiveErrors:0,
currentTense:null,
mode:'tenses'
},
stats:{
totalQuestions:0,
correctAnswers:0,
stars:0,
streak:0,
lastPracticeDate:null,
dailyStats:{},
weakItems:{}
},
tobeStats:{
total:0,
correct:0,
weakPairs:{}
}
};

const storage={
load(){
try{
const plan=localStorage.getItem('tenseTrainer_todayPlan');
const stats=localStorage.getItem('tenseTrainer_stats');
const tobe=localStorage.getItem('tenseTrainer_tobeStats');
const theme=localStorage.getItem('tenseTrainer_theme');
if(plan)state.todayPlan=JSON.parse(plan);
if(stats)state.stats=JSON.parse(stats);
if(tobe)state.tobeStats=JSON.parse(tobe);
if(theme)document.documentElement.setAttribute('data-theme',theme);
}catch(e){console.error('Storage load error:',e);}
},
save(){
try{
localStorage.setItem('tenseTrainer_todayPlan',JSON.stringify(state.todayPlan));
localStorage.setItem('tenseTrainer_stats',JSON.stringify(state.stats));
localStorage.setItem('tenseTrainer_tobeStats',JSON.stringify(state.tobeStats));
}catch(e){console.error('Storage save error:',e);}
},
saveTheme(theme){
localStorage.setItem('tenseTrainer_theme',theme);
}
};

const helpers={
shuffle(array){
const arr=[...array];
for(let i=arr.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1));
[arr[i],arr[j]]=[arr[j],arr[i]];
}
return arr;
},
pick(array){
return array[Math.floor(Math.random()*array.length)];
},
getToday(){
return new Date().toISOString().split('T')[0];
},
updateStreak(){
const today=helpers.getToday();
const last=state.stats.lastPracticeDate;
if(!last){
state.stats.streak=1;
}else if(last!==today){
const lastDate=new Date(last);
const todayDate=new Date(today);
const diffDays=(todayDate-lastDate)/(1000*60*60*24);
if(diffDays===1){
state.stats.streak++;
}else if(diffDays>1){
state.stats.streak=1;
}
}
state.stats.lastPracticeDate=today;
},
addStars(count){
state.stats.stars+=count;
},
recordWeakItem(key,tense){
if(!state.stats.weakItems[tense])state.stats.weakItems[tense]={};
if(!state.stats.weakItems[tense][key])state.stats.weakItems[tense][key]=0;
state.stats.weakItems[tense][key]++;
},
recordToBeWeak(subject,correctForm){
const key=`${subject}‚Üí${correctForm}`;
if(!state.tobeStats.weakPairs[key])state.tobeStats.weakPairs[key]=0;
state.tobeStats.weakPairs[key]++;
}
};

const exerciseGen={
generateForTense(tenseId,count=10){
const tense=TENSES_DATA[tenseId];
const exercises=[];
const templates=tense.templates;
const types=['wordOrder','multipleChoice','makeQuestion','makeNegative','fillBlank','findError'];
for(let i=0;i<count;i++){
const type=types[i%types.length];
const templateList=templates[type];
if(!templateList||templateList.length===0)continue;
const template=helpers.pick(templateList);
const exercise=this.createExercise(type,template,tense);
exercise.tense=tenseId;
exercises.push(exercise);
}
return helpers.shuffle(exercises);
},
createExercise(type,template,tense){
const base={type,tense:tense.id};
switch(type){
case'wordOrder':
return{...base,subtype:'wordOrder',words:helpers.shuffle(template.words),correctAnswer:template.answer,hint:'–°–æ–±–µ—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ'};
case'multipleChoice':
return{...base,subtype:'multipleChoice',question:template.question,options:template.options,correctAnswer:template.answer,hint:template.hint};
case'makeQuestion':
return{...base,subtype:'makeQuestion',question:`–°–¥–µ–ª–∞–π –≤–æ–ø—Ä–æ—Å: "${template.sentence}"`,correctAnswer:template.answer,hint:template.hint};
case'makeNegative':
return{...base,subtype:'makeNegative',question:`–°–¥–µ–ª–∞–π –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ: "${template.sentence}"`,correctAnswer:template.answer,hint:template.hint};
case'fillBlank':
return{...base,subtype:'fillBlank',question:`–í—Å—Ç–∞–≤—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–µ: "${template.sentence}"`,correctAnswer:template.answer,hint:template.hint};
case'findError':
return{...base,subtype:'findError',question:`–ù–∞–π–¥–∏ –∏ –∏—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫—É: "${template.sentence}"`,correctAnswer:template.correct,hint:template.hint};
default:
return base;
}
},
generateToBe(count=10){
const exercises=[];
const present=helpers.shuffle([...TOBE_EXERCISES.present]).slice(0,Math.ceil(count/2));
const past=helpers.shuffle([...TOBE_EXERCISES.past]).slice(0,Math.floor(count/2));
[...present,...past].forEach(ex=>{
exercises.push({...ex,type:'tobe',tense:'tobe'});
});
return helpers.shuffle(exercises);
}
};

const renderers={
home(){
const planCard=document.getElementById('todayPlanCard');
const planContent=document.getElementById('todayPlanContent');
const weakCard=document.getElementById('weakItemsHome');
const weakContent=document.getElementById('weakItemsHomeContent');
const streakDisplay=document.getElementById('streakDisplay');
if(state.stats.streak>0){
streakDisplay.innerHTML=`üî• –î–Ω–µ–π –ø–æ–¥—Ä—è–¥: <strong>${state.stats.streak}</strong>`;
}else{
streakDisplay.innerHTML='–ù–∞—á–Ω–∏ —É—á–∏—Ç—å—Å—è —Å–µ–≥–æ–¥–Ω—è! üöÄ';
}
if(state.todayPlan&&state.todayPlan.date===helpers.getToday()){
planCard.style.display='block';
const tenses=state.todayPlan.tenses.map(t=>TENSES_DATA[t].nameRu).join(', ');
const tobe=state.todayPlan.toBeWarmup?' + To Be —Ä–∞–∑–º–∏–Ω–∫–∞':'';
planContent.innerHTML=`<p><strong>${tenses}</strong>${tobe}</p>`;
}else{
planCard.style.display='none';
}
const weakItems=Object.entries(state.stats.weakItems);
if(weakItems.length>0){
weakCard.style.display='block';
weakContent.innerHTML=weakItems.slice(0,3).map(([tense,items])=>{
const tenseName=TENSES_DATA[tense]?.nameRu||tense;
const itemList=Object.entries(items).sort((a,b)=>b[1]-a[1]).slice(0,2);
return`<p>‚Ä¢ <strong>${tenseName}</strong>: ${itemList.map(([k,v])=>`${k} (${v})`).join(', ')}</p>`;
}).join('');
}else{
weakCard.style.display='none';
}
},
plan(){
const container=document.getElementById('tenseCheckboxes');
const savedPlanCard=document.getElementById('currentPlanCard');
const planDate=document.getElementById('planDate');
const savedContent=document.getElementById('savedPlanContent');
container.innerHTML=Object.values(TENSES_DATA).map(tense=>`
<label class="checkbox-item" data-tense="${tense.id}">
<input type="checkbox" value="${tense.id}" onchange="app.onTenseCheckbox(this)">
<div>
<div class="tense-name">${tense.nameRu}</div>
<div class="tense-desc">${tense.nameEn}</div>
</div>
</label>
`).join('');
if(state.todayPlan&&state.todayPlan.date===helpers.getToday()){
savedPlanCard.style.display='block';
planDate.textContent=state.todayPlan.date;
const tenses=state.todayPlan.tenses.map(t=>TENSES_DATA[t]?.nameRu||t).join(', ');
const tobe=state.todayPlan.toBeWarmup?'<p>üîÑ To Be —Ä–∞–∑–º–∏–Ω–∫–∞: <strong>–¥–∞</strong></p>':'';
savedContent.innerHTML=`<p>üìö –í—Ä–µ–º–µ–Ω–∞: <strong>${tenses}</strong></p>${tobe}`;
state.todayPlan.tenses.forEach(t=>{
const cb=container.querySelector(`input[value="${t}"]`);
if(cb){
cb.checked=true;
cb.closest('.checkbox-item').classList.add('checked');
}
});
document.getElementById('toBeWarmup').checked=state.todayPlan.toBeWarmup;
}else{
savedPlanCard.style.display='none';
}
},
tenses(){
const grid=document.getElementById('tensesGrid');
grid.innerHTML=Object.values(TENSES_DATA).map(tense=>`
<div class="tense-card" onclick="app.showTenseDetail('${tense.id}')">
<h4>${tense.nameRu}</h4>
<p style="color:var(--text-muted);margin-bottom:8px;">${tense.nameEn}</p>
<p class="example">${tense.examples[0].en}</p>
</div>
`).join('');
},
tenseDetail(tenseId){
const tense=TENSES_DATA[tenseId];
document.getElementById('detailTitle').textContent=`${tense.nameRu} ‚Äî ${tense.nameEn}`;
document.getElementById('detailUse').innerHTML=tense.useCases.map(u=>`‚Ä¢ ${u}`).join('<br>');
document.getElementById('detailFormulas').innerHTML=`
<div class="formula-row"><span class="formula-label pos">+</span><span>${tense.formulas.affirmative}</span></div>
<div class="formula-row"><span class="formula-label neg">‚àí</span><span>${tense.formulas.negative}</span></div>
<div class="formula-row"><span class="formula-label q">?</span><span>${tense.formulas.question}</span></div>
<div class="formula-row" style="background:#fef3c7;border-radius:4px;padding:8px;"><span style="margin-right:8px;">üëç/üëé</span><span>${tense.formulas.shortAnswers}</span></div>
`;
document.getElementById('detailSignals').innerHTML=tense.signalWords.map(w=>`<span style="display:inline-block;padding:4px 12px;background:white;border-radius:20px;margin:4px;font-size:0.9rem;">${w}</span>`).join('');
document.getElementById('detailExamples').innerHTML=tense.examples.map(ex=>`
<div style="padding:12px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px;">
<p style="font-weight:500;">${ex.en}</p>
<p style="color:var(--text-muted);font-size:0.9rem;">${ex.ru}</p>
</div>
`).join('');
document.getElementById('trainThisBtn').onclick=()=>{
app.startTraining([tenseId]);
};
},
stats(){
document.getElementById('statTotalQuestions').textContent=state.stats.totalQuestions;
const accuracy=state.stats.totalQuestions>0?Math.round((state.stats.correctAnswers/state.stats.totalQuestions)*100):0;
document.getElementById('statAccuracy').textContent=accuracy+'%';
document.getElementById('statStars').textContent=state.stats.stars;
document.getElementById('statStreak').textContent=state.stats.streak;
const starsDisplay=document.getElementById('starsDisplay');
const starCount=Math.min(state.stats.stars,10);
starsDisplay.innerHTML=Array(10).fill(0).map((_,i)=>`<span class="star ${i<starCount?'earned':'empty'}">‚òÖ</span>`).join('');
const weekChart=document.getElementById('weekChart');
const days=[];
for(let i=6;i>=0;i--){
const d=new Date();
d.setDate(d.getDate()-i);
days.push(d.toISOString().split('T')[0]);
}
const maxVal=Math.max(...days.map(d=>state.stats.dailyStats[d]?.total||0),1);
weekChart.innerHTML=days.map(date=>{
const stat=state.stats.dailyStats[date];
const val=stat?stat.total:0;
const height=Math.max((val/maxVal)*100,10);
const dayName=new Date(date).toLocaleDateString('ru',{weekday:'short'});
return`<div class="day-bar" style="height:${height}%" title="${val} –≤–æ–ø—Ä–æ—Å–æ–≤"><span class="day-value">${val}</span><span class="day-label">${dayName}</span></div>`;
}).join('');
const weakContent=document.getElementById('weakItemsStatsContent');
const weakItems=Object.entries(state.stats.weakItems);
if(weakItems.length>0){
weakContent.innerHTML=weakItems.map(([tense,items])=>{
const tenseName=TENSES_DATA[tense]?.nameRu||tense;
const itemList=Object.entries(items).sort((a,b)=>b[1]-a[1]).slice(0,3);
return`<div class="weak-item"><span class="weak-item-icon">‚ö†Ô∏è</span><div class="weak-item-text"><strong>${tenseName}</strong><div>${itemList.map(([k,v])=>`${k}`).join(', ')}</div></div><span class="weak-item-count">${Object.values(items).reduce((a,b)=>a+b,0)}</span></div>`;
}).join('');
}else{
weakContent.innerHTML='<p style="color:var(--text-muted);">–û—Ç–ª–∏—á–Ω–æ! –ü–æ–∫–∞ –Ω–µ—Ç —Å–ª–∞–±—ã—Ö –º–µ—Å—Ç üéâ</p>';
}
},
tobe(){
const statsContent=document.getElementById('tobeStatsContent');
const accuracy=state.tobeStats.total>0?Math.round((state.tobeStats.correct/state.tobeStats.total)*100):0;
statsContent.innerHTML=`<div class="stats-grid" style="margin-bottom:0;"><div class="stat-card"><div class="stat-value">${state.tobeStats.total}</div><div class="stat-label">–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤</div></div><div class="stat-card"><div class="stat-value">${accuracy}%</div><div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö</div></div></div>`;
const weakPairs=Object.entries(state.tobeStats.weakPairs);
if(weakPairs.length>0){
statsContent.innerHTML+=`<div style="margin-top:16px;"><h5 style="margin-bottom:8px;">‚ö†Ô∏è –ß–∞—Å—Ç—ã–µ –æ—à–∏–±–∫–∏:</h5>${weakPairs.sort((a,b)=>b[1]-a[1]).slice(0,3).map(([pair,count])=>`<span style="display:inline-block;padding:4px 12px;background:#fee2e2;border-radius:20px;margin:4px;font-size:0.85rem;">${pair} (${count})</span>`).join('')}</div>`;
}
}
};

const app={
init(){
storage.load();
this.navigate('home');
},
navigate(view){
document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
const viewEl=document.getElementById(`view-${view}`);
if(viewEl){
viewEl.classList.remove('hidden');
document.querySelector(`.nav-btn[data-view="${view}"]`)?.classList.add('active');
state.currentView=view;
switch(view){
case'home':renderers.home();break;
case'plan':renderers.plan();break;
case'tenses':renderers.tenses();break;
case'stats':renderers.stats();break;
case'tobe':renderers.tobe();break;
}
}
},
showTenseDetail(tenseId){
renderers.tenseDetail(tenseId);
document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
document.getElementById('view-tense-detail').classList.remove('hidden');
},
toggleTheme(){
const current=document.documentElement.getAttribute('data-theme');
const next=current==='dark'?'light':'dark';
document.documentElement.setAttribute('data-theme',next);
storage.saveTheme(next);
},
onTenseCheckbox(checkbox){
const item=checkbox.closest('.checkbox-item');
const checked=document.querySelectorAll('.checkbox-item.checked').length;
if(checkbox.checked){
if(checked>=3){
checkbox.checked=false;
document.getElementById('planError').classList.remove('hidden');
setTimeout(()=>document.getElementById('planError').classList.add('hidden'),3000);
return;
}
item.classList.add('checked');
}else{
item.classList.remove('checked');
}
},
applyPreset(preset){
const presets={
basic:['present_simple','past_simple'],
simple3:['present_simple','past_simple','future_simple'],
continuous:['present_continuous','past_continuous'],
perfect:['present_perfect','past_perfect'],
mixed:helpers.shuffle(['present_simple','past_simple','future_simple','present_continuous']).slice(0,2)
};
const tenses=presets[preset]||presets.basic;
this.savePlanWithTenses(tenses,true);
},
savePlan(){
const checkboxes=document.querySelectorAll('#tenseCheckboxes input:checked');
const tenses=Array.from(checkboxes).map(cb=>cb.value);
const toBeWarmup=document.getElementById('toBeWarmup').checked;
if(tenses.length===0){
alert('–í—ã–±–µ—Ä–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –≤—Ä–µ–º—è!');
return;
}
this.savePlanWithTenses(tenses,toBeWarmup);
},
savePlanWithTenses(tenses,toBeWarmup){
state.todayPlan={
date:helpers.getToday(),
tenses:tenses,
toBeWarmup:toBeWarmup
};
storage.save();
this.navigate('home');
},
startTraining(tenses=null){
const targetTenses=tenses||(state.todayPlan?.tenses);
if(!targetTenses||targetTenses.length===0){
alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –ø–ª–∞–Ω –Ω–∞ —Å–µ–≥–æ–¥–Ω—è!');
this.navigate('plan');
return;
}
if(state.todayPlan?.toBeWarmup&&!tenses){
this.startToBeTraining('quick',()=>{
this.startTenseTraining(targetTenses);
});
}else{
this.startTenseTraining(targetTenses);
}
},
startTenseTraining(tenses){
state.session.mode='tenses';
state.session.questions=[];
tenses.forEach(tense=>{
const questions=exerciseGen.generateForTense(tense,10);
state.session.questions.push(...questions);
});
state.session.questions=helpers.shuffle(state.session.questions);
state.session.currentIndex=0;
state.session.correct=0;
state.session.wrong=0;
state.session.consecutiveErrors=0;
state.session.active=true;
helpers.updateStreak();
this.showQuestion();
},
startToBeTraining(mode,callback=null){
state.session.mode='tobe';
state.session.questions=exerciseGen.generateToBe(mode==='quick'?8:15);
state.session.currentIndex=0;
state.session.correct=0;
state.session.wrong=0;
state.session.consecutiveErrors=0;
state.session.active=true;
state.session.tobeCallback=callback;
this.showQuestion();
},
showQuestion(){
if(state.session.currentIndex>=state.session.questions.length){
this.showResults();
return;
}
const q=state.session.questions[state.session.currentIndex];
state.session.currentTense=q.tense;
const progress=((state.session.currentIndex)/state.session.questions.length)*100;
document.getElementById('progressFill').style.width=progress+'%';
document.getElementById('feedbackBox').classList.add('hidden');
document.getElementById('hintBox').classList.add('hidden');
document.getElementById('miniCheat').classList.add('hidden');
document.getElementById('checkBtn').classList.remove('hidden');
document.getElementById('nextBtn').classList.add('hidden');
document.getElementById('hintBtn').classList.remove('hidden');
const typeLabels={
wordOrder:'–°–æ–±–µ—Ä–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ',
multipleChoice:'–í—ã–±–µ—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç',
makeQuestion:'–°–¥–µ–ª–∞–π –≤–æ–ø—Ä–æ—Å',
makeNegative:'–°–¥–µ–ª–∞–π –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ',
fillBlank:'–í—Å—Ç–∞–≤—å –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–µ',
findError:'–ò—Å–ø—Ä–∞–≤—å –æ—à–∏–±–∫—É',
tobe:'To Be'
};
document.getElementById('questionType').textContent=typeLabels[q.subtype]||typeLabels[q.type]||'–í–æ–ø—Ä–æ—Å';
document.getElementById('questionText').innerHTML=q.question;
this.renderExerciseType(q);
document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
document.getElementById('view-train').classList.remove('hidden');
},
renderExerciseType(q){
document.getElementById('wordBuilderContainer').classList.add('hidden');
document.getElementById('optionsContainer').classList.add('hidden');
document.getElementById('inputContainer').classList.add('hidden');
if(q.subtype==='wordOrder'){
document.getElementById('wordBuilderContainer').classList.remove('hidden');
const builder=document.getElementById('wordBuilder');
const bank=document.getElementById('wordBank');
builder.innerHTML='';
builder.classList.remove('filled');
bank.innerHTML=q.words.map(w=>`<span class="word-slot" data-word="${w}" onclick="app.onWordClick(this)">${w}</span>`).join('');
}else if(q.subtype==='multipleChoice'||(q.type==='tobe'&&q.options)){
document.getElementById('optionsContainer').classList.remove('hidden');
document.getElementById('optionsList').innerHTML=q.options.map(opt=>`<button class="option-btn" data-answer="${opt}" onclick="app.onOptionClick(this)">${opt}</button>`).join('');
}else{
document.getElementById('inputContainer').classList.remove('hidden');
const input=document.getElementById('answerInput');
input.value='';
input.focus();
input.onkeydown=(e)=>{if(e.key==='Enter')this.checkAnswer();};
}
},
onWordClick(el){
const builder=document.getElementById('wordBuilder');
const bank=document.getElementById('wordBank');
if(el.parentElement===bank){
builder.appendChild(el);
}else{
bank.appendChild(el);
}
if(builder.children.length>0){
builder.classList.add('filled');
}else{
builder.classList.remove('filled');
}
},
onOptionClick(el){
// –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
const q=state.session.questions[state.session.currentIndex];
const userAnswer=el.dataset.answer;

// –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
el.classList.add('selected');

// –°—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º
this.checkAnswerWithValue(userAnswer);
},
checkAnswerWithValue(userAnswer){
const q=state.session.questions[state.session.currentIndex];
if(!userAnswer)return;
// Normalize answers for comparison: lowercase, remove punctuation, extra spaces
const normalize=(s)=>s.toLowerCase().replace(/[.?!,;:]/g,'').replace(/\s+/g,' ').trim();
// For negative questions, accept only the verb part (e.g., "was")
// since '(not)' is already shown in the question
let correct=false;
if(q.type==='negative'){
    const verbPart=q.correctAnswer.split(' ')[0];
    correct=normalize(userAnswer)===normalize(verbPart);
}else{
    correct=normalize(userAnswer)===normalize(q.correctAnswer);
    if(!correct && q.short){
        correct=normalize(userAnswer)===normalize(q.short);
    }
}
this.showFeedback(correct,q);
state.stats.totalQuestions++;
state.tobeStats.total++;
if(correct){
state.session.correct++;
state.stats.correctAnswers++;
state.tobeStats.correct++;
state.session.consecutiveErrors=0;
}else{
state.session.wrong++;
state.session.consecutiveErrors++;
if(q.tense&&q.tense!=='tobe'){
helpers.recordWeakItem(q.subtype||q.type,q.tense);
}
if(q.type==='tobe'){
const subject=q.question.match(/^(I|you|he|she|it|we|they)\b/i)?.[1];
if(subject)helpers.recordToBeWeak(subject.toLowerCase(),q.correctAnswer);
}
if(state.session.consecutiveErrors>=2&&q.tense){
this.showMiniCheat(q.tense);
}
}
storage.save();
// –°–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º "–î–∞–ª—å—à–µ"
document.getElementById('checkBtn').classList.add('hidden');
document.getElementById('hintBtn').classList.add('hidden');
document.getElementById('nextBtn').classList.remove('hidden');
// –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –æ–ø—Ü–∏–π –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
if(q.options){
document.querySelectorAll('.option-btn').forEach(btn=>{
btn.disabled=true;
if(btn.dataset.answer===q.correctAnswer){
btn.classList.add('correct');
}else if(btn.classList.contains('selected')){
btn.classList.add('wrong');
}
});
}
// –ê–≤—Ç–æ–ø–µ—Ä–µ—Ö–æ–¥ —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
setTimeout(()=>{
this.nextQuestion();
},1500);
},
checkAnswer(){
const q=state.session.questions[state.session.currentIndex];
let userAnswer='';
if(q.subtype==='wordOrder'){
const words=Array.from(document.getElementById('wordBuilder').children).map(el=>el.dataset.word);
userAnswer=words.join(' ');
}else if(q.subtype==='multipleChoice'||(q.type==='tobe'&&q.options)){
const selected=document.querySelector('.option-btn.selected');
userAnswer=selected?selected.dataset.answer:'';
}else{
userAnswer=document.getElementById('answerInput').value.trim();
}
if(!userAnswer)return;
// Normalize answers for comparison: lowercase, remove punctuation, extra spaces
const normalize=(s)=>s.toLowerCase().replace(/[.?!,;:]/g,'').replace(/\s+/g,' ').trim();
// For negative questions, accept only the verb part (e.g., "was")
// since '(not)' is already shown in the question
let correct=false;
if(q.type==='negative'){
    const verbPart=q.correctAnswer.split(' ')[0]; // "was" from "was not"
    correct=normalize(userAnswer)===normalize(verbPart);
}else{
    correct=normalize(userAnswer)===normalize(q.correctAnswer);
    if(!correct && q.short){
        correct=normalize(userAnswer)===normalize(q.short);
    }
}
this.showFeedback(correct,q);
state.stats.totalQuestions++;
state.tobeStats.total++;
if(correct){
state.session.correct++;
state.stats.correctAnswers++;
state.tobeStats.correct++;
state.session.consecutiveErrors=0;
}else{
state.session.wrong++;
state.session.consecutiveErrors++;
if(q.tense&&q.tense!=='tobe'){
helpers.recordWeakItem(q.subtype||q.type,q.tense);
}
if(q.type==='tobe'){
const subject=q.question.match(/^(I|you|he|she|it|we|they)\b/i)?.[1];
if(subject)helpers.recordToBeWeak(subject.toLowerCase(),q.correctAnswer);
}
if(state.session.consecutiveErrors>=2&&q.tense){
this.showMiniCheat(q.tense);
}
}
storage.save();
document.getElementById('checkBtn').classList.add('hidden');
document.getElementById('hintBtn').classList.add('hidden');
document.getElementById('nextBtn').classList.remove('hidden');
if(q.subtype==='multipleChoice'||(q.type==='tobe'&&q.options)){
document.querySelectorAll('.option-btn').forEach(btn=>{
btn.disabled=true;
if(btn.dataset.answer===q.correctAnswer){
btn.classList.add('correct');
}else if(btn.classList.contains('selected')){
btn.classList.add('wrong');
}
});
}
},
showFeedback(correct,q){
const box=document.getElementById('feedbackBox');
box.classList.remove('hidden','correct','wrong');
box.classList.add(correct?'correct':'wrong');
box.innerHTML=`<div class="feedback-title">${correct?'‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ!':'‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ'}</div><div class="feedback-explanation">${correct?'–ú–æ–ª–æ–¥–µ—Ü! –ü—Ä–æ–¥–æ–ª–∂–∞–π –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!':`–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: <strong>${q.type==='negative'?q.correctAnswer.split(' ')[0]:q.correctAnswer}</strong>`}${q.hint?`<br><br>üí° ${q.hint}`:''}</div>`;
},
showHint(){
const q=state.session.questions[state.session.currentIndex];
const box=document.getElementById('hintBox');
const content=document.getElementById('hintContent');
box.classList.remove('hidden');
if(q.hint){
content.textContent=q.hint;
}else if(q.tense&&TENSES_DATA[q.tense]){
const tense=TENSES_DATA[q.tense];
content.innerHTML=`<strong>${tense.nameRu}:</strong><br>+ ${tense.formulas.affirmative}<br>–°–∏–≥–Ω–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞: ${tense.signalWords.slice(0,3).join(', ')}`;
}else{
content.textContent='–ü–æ–¥—É–º–∞–π –µ—â—ë —Ä–∞–∑! üí™';
}
},
showMiniCheat(tenseId){
if(tenseId==='tobe')return;
const tense=TENSES_DATA[tenseId];
if(!tense)return;
const mini=document.getElementById('miniCheat');
const content=document.getElementById('miniCheatContent');
mini.classList.remove('hidden');
content.innerHTML=`<strong>${tense.nameRu}</strong><br>+ ${tense.formulas.affirmative}<br>‚àí ${tense.formulas.negative}<br>? ${tense.formulas.question}`;
},
nextQuestion(){
state.session.currentIndex++;
this.showQuestion();
},
showResults(){
const total=state.session.questions.length;
const correct=state.session.correct;
const percentage=Math.round((correct/total)*100);
const today=helpers.getToday();
if(!state.stats.dailyStats[today]){
state.stats.dailyStats[today]={total:0,correct:0};
}
state.stats.dailyStats[today].total+=total;
state.stats.dailyStats[today].correct+=correct;
const newStars=Math.floor(correct/10);
if(newStars>0)helpers.addStars(newStars);
storage.save();
document.getElementById('resultScore').textContent=percentage+'%';
let message='';
if(percentage>=90)message='–û—Ç–ª–∏—á–Ω–æ! –¢—ã –º–æ–ª–æ–¥–µ—Ü! üéâ';
else if(percentage>=70)message='–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! üëç';
else if(percentage>=50)message='–ù–µ–ø–ª–æ—Ö–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞—Ç—å—Å—è! üí™';
else message='–ù–µ —Å–¥–∞–≤–∞–π—Å—è! –ü—Ä–∞–∫—Ç–∏–∫–∞ –ø–æ–º–æ–∂–µ—Ç! üöÄ';
document.getElementById('resultMessage').textContent=message;
document.getElementById('resultStars').innerHTML=Array(newStars).fill('‚≠ê').join('');
document.getElementById('resultDetails').innerHTML=`<p>–ü—Ä–∞–≤–∏–ª—å–Ω—ã—Ö: <strong>${correct}</strong> –∏–∑ ${total}</p><p>–ó–≤—ë–∑–¥ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong>${newStars}</strong></p>`;
const weakDiv=document.getElementById('weakItemsResult');
const weakList=document.getElementById('weakItemsList');
const weakItems=Object.entries(state.stats.weakItems);
if(weakItems.length>0){
weakDiv.classList.remove('hidden');
weakList.innerHTML=weakItems.map(([tense,items])=>{
const tenseName=TENSES_DATA[tense]?.nameRu||tense;
return`<p>‚Ä¢ <strong>${tenseName}</strong> ‚Äî –ø–æ–≤—Ç–æ—Ä–∏ –ø—Ä–∞–≤–∏–ª–∞</p>`;
}).join('');
}else{
weakDiv.classList.add('hidden');
}
document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
document.getElementById('view-result').classList.remove('hidden');
if(state.session.mode==='tobe'&&state.session.tobeCallback){
const callback=state.session.tobeCallback;
state.session.tobeCallback=null;
setTimeout(callback,100);
}
},
toggleParentMode(){
const section=document.getElementById('parentSection');
section.classList.toggle('hidden');
},
exportStats(){
const data={
stats:state.stats,
tobeStats:state.tobeStats,
exportedAt:new Date().toISOString()
};
const json=JSON.stringify(data,null,2);
navigator.clipboard.writeText(json).then(()=>{
alert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
});
},
resetStats(){
if(confirm('–¢–æ—á–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É? –≠—Ç–æ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')){
state.stats={
totalQuestions:0,
correctAnswers:0,
stars:0,
streak:0,
lastPracticeDate:null,
dailyStats:{},
weakItems:{}
};
state.tobeStats={total:0,correct:0,weakPairs:{}};
storage.save();
this.navigate('stats');
}
}
};

document.addEventListener('DOMContentLoaded',()=>app.init());
</script>

<!-- Footer with contact info -->
<footer style="background:var(--card-bg);border-top:1px solid var(--border);padding:1.5rem 1rem;margin-top:2rem;text-align:center;color:var(--muted)">
<div style="max-width:800px;margin:0 auto">
<p style="margin:0 0 0.5rem;font-weight:600;color:var(--text)">üìß –†–µ–∫–ª–∞–º–∞ –Ω–∞ —Å–∞–π—Ç–µ</p>
<p style="margin:0 0 0.5rem">–¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+79055529581" style="color:var(--primary);text-decoration:none">+7 (905) 552-95-81</a></p>
<p style="margin:0;font-size:0.875rem">¬© 2026 Tense Trainer ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂—ë—Ä –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –≤—Ä–µ–º—ë–Ω</p>
</div>
</footer>

</body>
</html>
